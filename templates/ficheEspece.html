<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="cache-control" content="no-cache" />

        <title> {%if taxon.taxonSearch.nom_vern %}  {{taxon.taxonSearch.nom_vern}} | {% endif %} {{taxon.taxonSearch.lb_nom}}</title>

        <!-- Jquery -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/jquery-ui.css') }}" />
        <script type=text/javascript src="{{url_for('static', filename='/lib/jquery-1.12.4.min.js') }}"></script>
        <script type=text/javascript src="{{url_for('static', filename='lib/jquery-ui.min.js') }}"></script>

        <!-- Bootrap -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap/css/bootstrap.min.css') }}"></link>
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap-switch/css/bootstrap-switch.min.css') }}"></link>
        <script type=text/javascript src="{{url_for('static', filename='lib/bootstrap/js/bootstrap.min.js') }}"></script>

        <link rel="stylesheet" href="{{url_for('static', filename='/lib/node_modules/bootstrap-slider/dist/css/bootstrap-slider.min.css') }}" />
        <script src="{{url_for('static', filename='/lib/node_modules/bootstrap-slider/dist/bootstrap-slider.min.js') }}"></script>


        <script type=text/javascript src="{{url_for('static', filename='/lib/bootstrap-switch/js/bootstrap-switch.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/bootstrap-switch/css/bootstrap-switch.min.css') }}" />


        <!-- Leaflet -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/leaflet/leaflet.css') }}" />
        <script src="{{url_for('static', filename='/lib/leaflet/leaflet.js') }}"></script>
        <script src="{{url_for('static', filename='/lib/leaflet/leafletMarkerCluster.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/leaflet/leafletMarkerCluster.css') }}" />
        <script src="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.css') }}" />

        <!-- D3 -->
        <script src="{{url_for('static', filename='/lib/d3/d3.min.js') }}"></script>

        <!-- MorrisJs -->
        <script src="{{url_for('static', filename='lib/morrisJs/morris.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/morrisJs/morris.css') }}" />
        <!-- RaphaelJs -->
        <script src="{{url_for('static', filename='lib/raphaelJs/raphael.min.js') }}"></script>

        <link rel="stylesheet" href="{{url_for('static', filename='/css/ficheEspece.css') }}" />
        <link rel="stylesheet" href="{{url_for('static', filename='/css/icones.css') }}" />

        <!-- LightBox -->
        <link rel="stylesheet" href="{{url_for('static', filename='/lib/lightbox2/css/lightbox.min.css') }}" />
        
        



    </head>

    <body>
    {% include 'navbar.html' %}

    <!-- SAUT DE LIGNE -->

    <div class="col-sm-12" style="height:20px"></div>

    <div class="container-fluid">
        <div id="sideBar"class="col-sm-1">
        {% include 'sideBar.html' %}
        </div>

        <div class='col-sm-7'>
            <div class="panel panel-default" id="identityPanel">
                <div class= "row" id="rowImg">
                    <div class="col-sm-6 col-lg-6" id="imgCol" > 
                        <div class="imgWrapper">
                            {% if ( (firstPhoto.url  == None) and (firstPhoto.path == None) ) or (firstPhoto == None)  %}
                                <img src="{{url_for('static', filename='images/Photo_non_disponible.png') }}" style="width:100%;height: 100%; border-right: solid 1px;">
                            {% elif firstPhoto.path != None %}
                                <a href="{{firstPhoto.url}}" data-lightbox="imageSet" data-title="{{firstPhoto.title}} - &copy; {{firstPhoto.author}}" >
                                    <img class ="imgToCarousel" id="myImg" src="{{configuration.URL_PHOTO}}{{firstPhoto.path}}" style="width:100%;height: 100%;">
                                    <p class="imgDescription main"> {{firstPhoto.title}} - &copy; {{firstPhoto.author}} </p>
                                </a>
                            {% else %}
                            
                            <a href="{{firstPhoto.url}}" data-lightbox="imageSet" data-title="{{firstPhoto.title}} - &copy; {{firstPhoto.author}}" >
                                <img  id="myImg" src="{{firstPhoto.url}}" style="width:100%;height: 100%;">
                                <p class="imgDescription main"> {{firstPhoto.title}} - &copy; {{firstPhoto.author}} </p>
                            </a>
                           {% endif %}
                        </div>

                    </div>



                    <div class="col-sm-5" id="taxonIdentity">
                        {% if taxon.taxonSearch.nom_vern != None %}
                            <h3>  {{taxon.taxonSearch.nom_vern}} 
                        
                        {% endif %}
                            <h3> {{taxon.taxonSearch.nom_complet_html|safe}} </h3>
                        

                        <div style="margin-top:30px">
                            {% for taxon in taxonomyHierarchy %}
                                {{taxon.nom_rang}} :
                                <i>
                                {% if ( taxon.tri_rang >= configuration.LIMIT_FICHE_LISTE_HIERARCHY) %}
                                     <a href = "{{url_for('main.ficheEspece', cd_ref = taxon.cd_ref) }}"> {{taxon.lb_nom}}</a> 
                                {% else %}
                                     <a href = "{{url_for('main.ficheRangTaxonomie', cd_ref = taxon.cd_ref) }}">{{taxon.lb_nom}} </a> 

                                {% endif %}
                                </i>
                                {% if not loop.last %}
                                     <span class="glyphicon glyphicon-chevron-right"> </span>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div id="inpnLink">
                            <br> <br>
                            <a href='https://inpn.mnhn.fr/espece/cd_nom/{{taxon.taxonSearch.cd_ref}}' target="_blank"> 
                                <img width="30%" src="{{url_for('static', filename='images/logo_inpn.png') }}">
                             </a>
                        </div>

                    
                    
                        {% if taxon.listTaxonsChild|length > 0 %}
                            <h5 id="buttonChild"> Noms des taxons agregés sur cette fiche:  <span class="glyphicon glyphicon-chevron-right"> </span> </h5> 
                                <div hidden="hidden" id="childList">
                                    {% for child in taxon.listTaxonsChild %}
                                     <i>
                                        {% if ( child.tri_rang >= configuration.LIMIT_FICHE_LISTE_HIERARCHY) %}
                                            <a href = "{{url_for('main.ficheEspece', cd_ref = child.cd_ref) }}"> {{child.lb_nom}}</a> 
                                        {% else %}
                                            <a href = "{{url_for('main.ficheRangTaxonomie', cd_ref = child.cd_ref) }}">{{child.lb_nom}} </a> 
                                        {% endif %}
                                        </i>
                                        {% if not loop.last %}
                                          ,
                                    {% endif %}
                                {% endfor %}
                                </div>
                        {% endif %}
                    </div>  
                    <div class="col-xs-1" id="logoCol">
                        <img id="logoImg"src= "/atlas/static/images/picto_{{taxon.taxonSearch.group2_inpn|urlencode}}.png" alt ="{{taxon.taxonSearch.group2_inpn}}" title = "{{taxon.group2_inpn}}">
                    </div>
                </div>  
            </div>
            <div class="panel panel-default" id="mapPanel">
                <div class ="row">
                    <div class="col-sm-10" id="mapContainer">
                        <div id="map"> </div>
                    </div>
                    <div class="col-sm-2" id="mapStat">
                        <ul>
                            <li> <span data-icon="&#xe037;" style="font-size: 30px;"></span> </br> <b> {{observations.maille|length}} </b> </br> Observations  </li>
                            <li> <img id="picto" src="{{url_for('static', filename='images/church.png') }}" style="width"> <br> <b> {{communes|length}}</b> </br>Communes </li>
                            <li> <span data-icon="&#xe040;"  style="font-size: 30px;"> </span> </br> <b> {{observers|length}} </b> </br> Observateurs </li>
                            <li id="firstObs" class="pointer"> <span data-icon="&#xe037;" style="font-size: 25px; color: brown"></span> </br> <b> 1ère observation </b> </br>  {{taxon.taxonSearch.yearmin|int}} </li>
                            <li id="lastObs" class="pointer"> <span data-icon="&#xe037;" style="font-size: 25px; color: blue"></span> </br> <b> Dernière observation </b> </br> {{taxon.taxonSearch.yearmax|int}}  </li>

                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel panel-default" id="otherInformationsPanel">
                <div class="row" id="otherInformations">
                          <ul class="nav nav-tabs">
                            <li class="active"><a data-toggle="tab" href="#artciles"><b>{{articles|length}}</b> Articles</a></li>
                            <li><a data-toggle="tab" href="#communes"> <b>{{communes|length}}</b> Communes</a></li>
                            <li><a data-toggle="tab" href="#observateurs"> <b>{{observers|length}} </b> Observateurs</a></li>
                          </ul>

                        <div class="tab-content" style="width:100%;">
                            <div id = "artciles" class="tab-pane fade in active">
                                <table class="table table-striped">
                                    <thead>
                                        <th> Titre </th>
                                        <th> Auteur </th>
                                    </thead>
                                    <tbody>
                                        {% for article in articles %}
                                            <tr>
                                            
                                                <td> <a href="{{article.url}}" target="_blank"> {{article.title}} </a> </td>
                                                <td> {{article.author}} </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div id="communes" class="tab-pane fade">
                                         <p>
                                                {% for com in communes %}
                                                    <a href = "{{url_for('main.ficheCommune', insee = com.insee) }}"> {{com.commune_maj}} </a>
                                                    {% if not loop.last %}
                                                    ,
                                                    {% endif %}
                                                {% endfor %}
                                                </p>    
                            </div>
                           
                            <div id="observateurs" class="tab-pane fade">
                                {% for o in observers %}
                                    {{o }}
                                    {% if  not loop.last %}
                                    -
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                </div>
            </div>


        </div>

        

        <div class="col-sm-4">
            {% if photoCarousel | length >= 1 %}
            <div class="panel panel-default">
                  <div id="fixed" class="carousel slide" data-ride="carousel" data-interval="false">
                      <!-- Indicators -->
                      <ol class="carousel-indicators">
                      {% for i in range(photoCarousel|length) %}
                            {% if loop.first %}
                            <li data-target="#fixed" data-slide-to="{{i}}" class="active"></li>
                            {%  else %}
                            <li data-target="#fixed" data-slide-to="{{i}}"></li>
                            {% endif %}
                      {% endfor %}
                      </ol>

                      <!-- Wrapper for slides -->
                      <div class="carousel-inner">
                        {% for photo in photoCarousel %}
                            {% if loop.first %}
                            <div class="item active">
                            {% else %}
                            <div class="item">
                            {% endif %}
                                {% if photo.path != None %}
                                <a href="{{configuration.URL_PHOTO}}{{photo.path}}" data-lightbox="imageSet" data-title="{{photo.title}} - &copy; {{photo.author}}" >
                                  <div style="background:url({{configuration.URL_PHOTO}}{{photo.path}}) center center; background-size:cover;" class="slider-size">
                                {% else %}
                                <a href="{{photo.url}}" data-lightbox="imageSet" data-title="{{photo.title}} - &copy; {{photo.author}}" >
                                  <div style="background:url({{photo.url}}) center center; background-size:cover;" class="slider-size">
                                {% endif %}
                                      <div class="carousel-caption">
                                       {{photo.title}} - &copy; {{photo.author}}
                                      </div>
                                  </div>
                                </a>
                            </div>
                        {% endfor %}
                      </div>

                      <!-- Controls -->
                      <a class="left carousel-control" href="javascript:void(0)" data-slide="prev" data-target="#fixed">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                      </a>
                      <a class="right carousel-control" href="javascript:void(0)" data-slide="next" data-target="#fixed">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                      </a>
                    </div>
            </div>
            {% endif %}

            
            <div class="panel panel-default" style="padding: 10px;">

                        <h4> <strong> Information sur l'espèce </strong> </h4>
                          <ul class="nav nav-tabs" style="margin-botton:10px;">
                            <li class="active"><a data-toggle="tab" href="#description">Description</a></li>
                            <li><a data-toggle="tab" href="#commentaire">Commentaire</a></li>
                            <li><a data-toggle="tab" href="#milieu">Milieu</a></li>
                            <li><a data-toggle="tab" href="#chorologie">Chorologie</a></li>
                            <li><a data-toggle="tab" href="#synonymes">Synonymes</a></li>
                          </ul>

                    
                        <div class="tab-content" style="width:100%;">
                            <div id="description" class="tab-pane fade in active">
                               {% if taxonDescritpion.description == None %}
                                Non renseignée pour le moment
                                {% else %}
                                {{taxonDescritpion.description}}
                                {% endif %}
                            </div>
                            <div id="commentaire" class="tab-pane fade">
                                {% if taxonDescritpion.commentaire == None %}
                                    Non renseigné pour le moment
                                {% else %}
                                    {{taxonDescritpion.commentaire}}
                                {% endif %}
                            </div>
                            <div id="milieu" class="tab-pane fade">
                                {% if taxonDescritpion.milieu == None %}
                                    Non renseigné pour le moment
                                {% else %}
                                {{taxonDescritpion.milieu}}
                                {% endif %}
                            </div>  
                            <div id="chorologie" class="tab-pane fade">                                
                                {% if taxonDescritpion.corrologie == None %}
                                    Non renseignée pour le moment
                                {% else %}
                                    {{taxonDescritpion.corrologie}}
                                {% endif %}
                            </div>
                            <div id="synonymes" class="tab-pane fade">
                                {%for syn in synonyme %} 
                                    {% if not syn.lb_nom == taxon.lb_nom %}
                                    {{syn.lb_nom}}
                                    {% endif %}
                                    {% if ( (not loop.last) and (not syn.lb_nom == taxon.lb_nom) ) %}
                                    -
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                        </div>
                    
            </div>
            {% if (videoAudio.video | length > 0 ) or (videoAudio.audio | length > 0) %}
            <div class="panel panel-default" style="padding: 10px;">

                {% if videoAudio.video |length > 0 %}
                    <h4> <strong>  Video </strong> ({{videoAudio.video | length}})
                        {% if videoAudio.video | length > 1 %}
                         <i class ="btn-more" id="btn-more-video" data-toggle="collapse" data-target="#moreVideo" rel="tooltip" title="Afficher plus de video "> <span class="glyphicon glyphicon-plus"> </span> </i>
                        {% endif %}  
                    </h4>
                    <hr class="small-hr">
                    <h4>{{videoAudio.video[0].title}}</h4>
                    {% if videoAudio.video[0].id_type == 6 %}
                        <video controls>
                          <source src="{{video.path}}" type="video/mp4">
                        </video>
                        {% else %}
                            {{videoAudio.video[0].path|safe}}
                        {% endif %}
                    
                    <div id="moreVideo" class="collapse">
                        {% for i in range (1, videoAudio.video |length) %}
                            <h4> {{videoAudio.video[i].title}}</h4>
                            {% if videoAudio.video[i].id_type == 6 %}
                                    <video controls>
                                      <source src="{{videoAudio.video[i].path}}" type="video/mp4">
                                    </video>
                                    <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#moreVideo">Plus de vidéo</button>
                                {% else %}
                                    {{videoAudio.video[i].path|safe}}
                                {% endif %}
                            
                        {% endfor %}
                    </div>
                {% endif %}

                {% if videoAudio.audio | length > 0 %}
                    <h4> <strong>  Audio </strong> ({{videoAudio.audio | length}})
                        {% if videoAudio.audio | length > 1 %}
                        <i class ="btn-more" id="btn-more-audio" data-toggle="collapse" data-target="#moreAudio" rel="tooltip" title="Afficher plus d'enregistrement "> <span class="glyphicon glyphicon-plus"> </span> </i>
                        {% endif %}
                    </h4>
                    <hrclass="small-hr"> 

                    <h4>{{videoAudio.audio[0].title}}</h4>                     
                    <audio controls>
                            <source src="{{ videoAudio.audio[0].path }}" type="audio/mpeg">
                    </audio>

                    <div id="moreAudio" class="collapse">
                        {% for i in range (1, videoAudio.audio |length) %}
                            <h4> {{videoAudio.audio[i].title}} </h4>
                            <audio controls>
                                <source src="{{ videoAudio.audio[i].path }}" type="audio/mpeg">
                            </audio>
                        {% endfor %}
                    </div>
                {% endif %}

            </div>
            {% endif %}

        
            <div class="panel panel-default">
                
                    <h3 class="text-primary text-center"> Observations par classes d'altitudes </h3>
                    <div id="altiChart" style="height: 200px;"></div>
                    <h3 class="text-primary text-center"> Observations mensuelles </h3>
                    <div id="phenologyChart" style="height: 200px;"> </div>
                
            </div>


        </div>
     

      
    </div>

    <script  src="{{url_for('static', filename='/lib/lightbox2/js/lightbox.min.js') }}" ></script>
    
    <script type="text/javascript" src="/atlas/static/conf/calculCustom.js"></script>

    <script type="text/javascript" src="/atlas/static/conf/custom.js"></script>


    <script> 
             var dataset = {{altitudes|tojson}},
                 months = {{months|tojson}}
                 {% if not configuration.AFFICHAGE_MAILLE %}
                 observationsPoint = {{observations.point|tojson}},
                 {% endif %}
                 observationsMaille = {{observations.maille|tojson}}
                 listeTaxonsSearch = {{listeTaxonsSearch|tojson}},
                 communesSearch = {{communesSearch|tojson}},
                 configuration = {{configuration|tojson}},
                 url_limit_territory = "{{url_for('static', filename='territoire.json') }}",
                 taxonYearMin = {{taxon.taxonSearch.yearmin}};

    </script>  


    <script type="text/javascript" src="/atlas/static/chart.js"></script>

   
   <script src="{{url_for('static', filename='mapGenerator.js') }}"></script>
   {% if configuration.AFFICHAGE_MAILLE %}
        <script src="{{url_for('static', filename='mapMailles.js') }}"></script>
    {% else %}
        <script src="{{url_for('static', filename='mapPoint.js') }}"></script>
    {% endif %}
    <script src="{{url_for('static', filename='main.js') }}"></script>
    <script src="{{url_for('static', filename='ficheEspece.js') }}"></script>

    </body>
</html>