{% block topSpecies %}
<div class="card mt-4" id="mapPanel mt-4">
    <!-- Card title-->
    <h4 class="title-bar center mt-2">
        <strong>{{ _('top.species') }}</strong>
    </h4>
    <!-- List taxons-->
    <div id="taxonList" class="d-flex align-content-stretch bg-white flex-grow-1">
        <ul class="list-group w-100">
            {% for taxon in mostObsTaxs %}
            <li id="taxonListItem" class="d-flex border-bottom p-2 align-items-center" cdRef="{{ taxon.cd_ref }}">
                <!-- Image -->
                <div class="pictoImgList me-2" data-bs-placement="center">
                    {% if taxon["photo"]["path"] == None or not taxon["photo"]["path"] %}
                    <img class="mx-auto d-block"
                         src="{{ url_for('static', filename='images/picto_'+ taxon.group2_inpn| replace(" ", "_") |urlencode+'.png') }}">
                    {% else %}
                        {% if configuration.REDIMENSIONNEMENT_IMAGE %}
                            {% set img_path = configuration.TAXHUB_URL+'/api/tmedias/thumbnail/'+ taxon.photo.id_media|string+'?h=100&w=150' %}
                        {% else %}
                            {% set img_path = configuration.REMOTE_MEDIAS_URL+taxon.photo.path %}
                        {% endif %}
                    <img class="mainImg" src="{{ img_path }}" style='width:100px'>
                    {% endif %}
                </div>

                <!-- Text + badges -->
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start">
                        <!-- Title & scientific name -->
                        <div>
                            <h5 class="mt-0 mb-1">
                                <b>{% if taxon.nom_vern == None %} - {% else %}{{ taxon.nom_vern.split(',')[0].strip() }}{% endif %}</b>
                            </h5>
                            <h5>
                                <span id="name"><i>{{ taxon.lb_nom }}</i></span>
                            </h5>

                            <!-- Observations -->
                            <b>{{ taxon['nb_obs_taxon'] }}</b>
                            {% if taxon['nb_obs_taxon'] == 1 %}
                                {{ _('observation') }}
                            {% else %}
                                {{ _('observations') }}
                            {% endif %}
                            <br>
                            <b>{{ "%.2f"|format(taxon['nb_obs_taxon'] / taxon['nb_obs_taxon'] * 100) }}%</b>
                            {{ _('from.organism.observations') }}
                        </div>

                        <!-- Badges (protection + patrimonialitÃ©) -->
                        <div class="d-flex flex-column align-items-end">
                            {% if configuration.PROTECTION and taxon.protection == 'oui' %}
                            <a href="https://inpn.mnhn.fr/espece/cd_nom/{{ taxon.cd_ref }}/tab/statut" target="_blank">
                                <img src="{{ url_for('static', filename='images/logo_protection.png') }}"
                                     style="width: 30px; height: 30px;"
                                     data-bs-toggle="tooltip"
                                     title="{{ _('this.taxon.has.a.protected.status') }}">
                            </a>
                            {% endif %}

                            {% if configuration.DISPLAY_PATRIMONIALITE %}
                                {% if taxon.patrimonial in configuration.PATRIMONIALITE.config %}
                                <img src="{{ url_for('static', filename=configuration.PATRIMONIALITE.config[taxon.patrimonial].icon) }}"
                                     style="width: 30px; height: 30px;"
                                     data-bs-toggle="tooltip"
                                     title="{{ configuration.PATRIMONIALITE.config[taxon.patrimonial].text }}">
                                {% endif %}
                            {% endif %}

                            <!-- Link to species sheet -->
                            <a class="badge bg-primary mt-2 text-white text-decoration-none"
                               href="{{ url_for('main.ficheEspece', cd_nom=taxon['cd_ref']) }}"
                               data-bs-toggle="tooltip"
                               title="{{ _('check.species.sheet') }}">
                                <i class="fas fa-list fa-fw"></i> {{ _('species.sheet') }}
                            </a>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}